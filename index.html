<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTTmanager</title>
    <style>
        :root {
            --bg-color: #263238;
            --header-color: #37474F;
            --accent-color: #009688;
            --text-color: #ECEFF1;
            --highlight-color: #546E7A;
            --message-sent: #1976D2;
            --message-received: #2E7D32;
            --button-color: #455A64;
            --sender-color: #B0BEC5;
        }
        
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            display: none;
            flex-direction: column;
            height: 100%;
        }
        
        .header {
            background-color: var(--header-color);
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header h1 {
            margin: 0;
            color: var(--accent-color);
            font-size: 18px;
        }
        
        button {
            background-color: var(--button-color);
            color: var(--text-color);
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: var(--highlight-color);
        }
        
        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .chat-item {
            padding: 12px;
            margin-bottom: 8px;
            background-color: var(--header-color);
            border-radius: 4px;
            cursor: pointer;
        }
        
        .chat-item:hover {
            background-color: var(--highlight-color);
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .message {
            margin-bottom: 12px;
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 8px;
            word-wrap: break-word;
        }
        
        .message-sent {
            background-color: var(--message-sent);
            margin-left: auto;
        }
        
        .message-received {
            background-color: var(--message-received);
            margin-right: auto;
        }
        
        .message-system {
            background-color: var(--bg-color);
            color: var(--sender-color);
            font-style: italic;
            text-align: center;
            margin: 8px auto;
        }
        
        .sender-info {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            color: var(--sender-color);
            font-size: 12px;
        }
        
        .avatar {
            font-size: 16px;
            margin-right: 6px;
        }
        
        .input-area {
            display: flex;
            padding: 10px;
            background-color: var(--header-color);
        }
        
        input {
            flex: 1;
            padding: 8px;
            background-color: var(--highlight-color);
            border: none;
            color: var(--text-color);
            border-radius: 4px;
            margin-right: 8px;
        }
        
        .profile-content {
            padding: 20px;
        }
        
        .profile-field {
            margin-bottom: 15px;
        }
        
        .profile-field label {
            display: block;
            margin-bottom: 5px;
        }
        
        .profile-field input, .profile-field textarea {
            width: 100%;
            padding: 8px;
            background-color: var(--highlight-color);
            border: none;
            color: var(--text-color);
            border-radius: 4px;
        }
        
        .avatar-large {
            font-size: 40px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- –ß–∞—Ç-–ª–∏—Å—Ç -->
    <div id="chat-list" class="container">
        <div class="header">
            <h1>DTTmanager</h1>
            <button onclick="showContainer('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
        <div id="chats" class="chat-list"></div>
        <div style="padding: 10px;">
            <button onclick="createChatDialog()" style="width: 100%;">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</button>
        </div>
    </div>
    
    <!-- –ß–∞—Ç -->
    <div id="chat" class="container">
        <div class="header">
            <button onclick="showContainer('chat-list')">–ù–∞–∑–∞–¥</button>
            <h1 id="chat-title">–ß–∞—Ç</h1>
            <button id="leave-chat-btn" style="display: none;">–ü–æ–∫–∏–Ω—É—Ç—å</button>
        </div>
        <div id="messages" class="messages-container"></div>
        <div class="input-area">
            <input id="message-input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleKeyPress(event)">
            <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <div id="profile" class="container">
        <div class="header">
            <button onclick="showContainer('chat-list')">–ù–∞–∑–∞–¥</button>
            <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
        </div>
        <div class="profile-content">
            <div class="avatar-large" id="user-avatar">üòÄ</div>
            <button onclick="changeAvatar()">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
            
            <div class="profile-field">
                <label>–ò–º—è:</label>
                <input id="first-name" type="text">
            </div>
            
            <div class="profile-field">
                <label>–§–∞–º–∏–ª–∏—è:</label>
                <input id="last-name" type="text">
            </div>
            
            <div class="profile-field">
                <label>–Æ–∑–µ—Ä–Ω–µ–π–º:</label>
                <div style="display: flex;">
                    <input id="username" type="text" style="flex: 1;">
                    <button onclick="changeUsername()" style="margin-left: 8px;">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="profile-field">
                <label>–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è (–ì–ì–ì–ì-–ú–ú-–î–î):</label>
                <div style="display: flex;">
                    <input id="birthday" type="text" style="flex: 1;">
                    <button onclick="changeBirthday()" style="margin-left: 8px;">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="profile-field">
                <label>–û —Å–µ–±–µ:</label>
                <textarea id="bio" rows="4"></textarea>
            </div>
            
            <div class="profile-field">
                <label>ID:</label>
                <input id="user-id" type="text" readonly>
            </div>
            
            <div id="restriction-status" style="color: var(--accent-color); margin: 15px 0;"></div>
            
            <button onclick="saveProfile()" style="width: 100%;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>
    </div>
    
    <script>
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const appData = {
            user: {
                id: generateUUID(),
                firstName: "User",
                lastName: "",
                username: "user" + Math.floor(1000 + Math.random() * 9000),
                bio: "",
                birthday: null,
                avatar: randomAvatar(),
                activeChats: ["–û–±—â–∏–π —á–∞—Ç"],
                usernameChanges: [],
                birthdayChanges: [],
                bans: 0,
                blockedUntil: null,
                birthdayBlockedUntil: null
            },
            chats: {
                "–û–±—â–∏–π —á–∞—Ç": {
                    type: "public",
                    messages: [
                        {senderId: "system", text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±—â–∏–π —á–∞—Ç!", time: "12:00"}
                    ],
                    members: []
                }
            },
            privateChats: {},
            currentChat: null,
            usernames: new Set(),
            online: false
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            loadData();
            updateChatList();
            showContainer('chat-list');
            updateProfileFields();
        };
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        
        // –°–ª—É—á–∞–π–Ω—ã–π –∞–≤–∞—Ç–∞—Ä
        function randomAvatar() {
            const avatars = ['üòÄ', 'üòé', 'ü§ñ', 'üëΩ', 'üê∂', 'üê±', 'ü¶ä'];
            return avatars[Math.floor(Math.random() * avatars.length)];
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function loadData() {
            const savedData = localStorage.getItem('dtt_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                appData.user = {...appData.user, ...data.user};
                if (!appData.user.activeChats.includes("–û–±—â–∏–π —á–∞—Ç")) {
                    appData.user.activeChats.push("–û–±—â–∏–π —á–∞—Ç");
                }
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º —á–∞—Ç—ã
                appData.chats = {...appData.chats, ...data.chats};
                if (!appData.chats["–û–±—â–∏–π —á–∞—Ç"]) {
                    appData.chats["–û–±—â–∏–π —á–∞—Ç"] = {
                        type: "public",
                        messages: [
                            {senderId: "system", text: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–±—â–∏–π —á–∞—Ç!", time: "12:00"}
                        ],
                        members: []
                    };
                }
                
                // –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã
                if (data.privateChats) {
                    appData.privateChats = data.privateChats;
                }
                
                // –Æ–∑–µ—Ä–Ω–µ–π–º—ã
                if (data.usernames) {
                    appData.usernames = new Set(data.usernames);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —é–∑–µ—Ä–Ω–µ–π–º
            if (!appData.usernames.has(appData.user.username)) {
                appData.usernames.add(appData.user.username);
            }
            
            saveData();
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            const data = {
                user: appData.user,
                chats: appData.chats,
                privateChats: appData.privateChats,
                usernames: Array.from(appData.usernames)
            };
            
            localStorage.setItem('dtt_data', JSON.stringify(data));
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        function showContainer(containerId) {
            document.getElementById('chat-list').style.display = 'none';
            document.getElementById('chat').style.display = 'none';
            document.getElementById('profile').style.display = 'none';
            
            document.getElementById(containerId).style.display = 'flex';
            
            if (containerId === 'profile') {
                updateProfileFields();
                checkRestrictions();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
        function updateChatList() {
            const chatsList = document.getElementById('chats');
            chatsList.innerHTML = '';
            
            appData.user.activeChats.forEach(chatName => {
                if (appData.chats[chatName]) {
                    const chatItem = document.createElement('div');
                    chatItem.className = 'chat-item';
                    chatItem.textContent = chatName;
                    chatItem.onclick = () => openChat(chatName, false);
                    chatsList.appendChild(chatItem);
                } else {
                    for (const code in appData.privateChats) {
                        if (appData.privateChats[code].name === chatName) {
                            const chatItem = document.createElement('div');
                            chatItem.className = 'chat-item';
                            chatItem.textContent = `[–ü—Ä–∏–≤–∞—Ç–Ω—ã–π] ${chatName}`;
                            chatItem.onclick = () => openChat(code, true);
                            chatsList.appendChild(chatItem);
                            break;
                        }
                    }
                }
            });
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
        function openChat(identifier, isPrivate) {
            appData.currentChat = {identifier, isPrivate};
            
            const chatTitle = document.getElementById('chat-title');
            const leaveBtn = document.getElementById('leave-chat-btn');
            
            if (isPrivate) {
                chatTitle.textContent = appData.privateChats[identifier].name;
                leaveBtn.style.display = 'block';
                leaveBtn.onclick = () => leaveChat(identifier, true);
            } else {
                chatTitle.textContent = identifier;
                leaveBtn.style.display = identifier !== "–û–±—â–∏–π —á–∞—Ç" ? 'block' : 'none';
                leaveBtn.onclick = () => leaveChat(identifier, false);
            }
            
            showContainer('chat');
            displayMessages(identifier, isPrivate);
        }
        
        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
        function displayMessages(identifier, isPrivate) {
            const messagesContainer = document.getElementById('messages');
            messagesContainer.innerHTML = '';
            
            const messages = isPrivate 
                ? appData.privateChats[identifier].messages 
                : appData.chats[identifier].messages;
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                
                if (msg.senderId === 'system') {
                    messageDiv.className = 'message message-system';
                    messageDiv.textContent = msg.text;
                } else {
                    const isSent = msg.senderId === appData.user.id;
                    messageDiv.className = `message ${isSent ? 'message-sent' : 'message-received'}`;
                    
                    if (!isSent) {
                        const senderInfo = document.createElement('div');
                        senderInfo.className = 'sender-info';
                        
                        const avatarSpan = document.createElement('span');
                        avatarSpan.className = 'avatar';
                        avatarSpan.textContent = msg.avatar || 'üë§';
                        
                        const nameSpan = document.createElement('span');
                        nameSpan.textContent = `${msg.senderName || 'Unknown'} @${msg.username || ''}`;
                        
                        senderInfo.appendChild(avatarSpan);
                        senderInfo.appendChild(nameSpan);
                        messageDiv.appendChild(senderInfo);
                    }
                    
                    const textDiv = document.createElement('div');
                    textDiv.textContent = msg.text;
                    messageDiv.appendChild(textDiv);
                    
                    const timeDiv = document.createElement('div');
                    timeDiv.style = 'font-size: 10px; text-align: right; margin-top: 4px;';
                    timeDiv.textContent = msg.time || new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    messageDiv.appendChild(timeDiv);
                }
                
                messagesContainer.appendChild(messageDiv);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            if (!text || !appData.currentChat) return;
            
            const isBirthday = checkBirthday();
            
            const newMsg = {
                senderId: appData.user.id,
                senderName: `${appData.user.firstName} ${appData.user.lastName}`.trim() || "User",
                username: appData.user.username,
                avatar: appData.user.avatar,
                text: text,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                timestamp: Date.now(),
                isBirthday: isBirthday
            };
            
            if (appData.currentChat.isPrivate) {
                appData.privateChats[appData.currentChat.identifier].messages.push(newMsg);
            } else {
                appData.chats[appData.currentChat.identifier].messages.push(newMsg);
            }
            
            saveData();
            displayMessages(appData.currentChat.identifier, appData.currentChat.isPrivate);
            input.value = '';
            input.focus();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è
        function checkBirthday() {
            if (!appData.user.birthday) return false;
            
            const today = new Date();
            const bday = new Date(appData.user.birthday);
            
            return today.getMonth() === bday.getMonth() && today.getDate() === bday.getDate();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter
        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }
        
        // –ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç
        function leaveChat(identifier, isPrivate) {
            let chatName;
            
            if (isPrivate) {
                chatName = appData.privateChats[identifier].name;
            } else {
                chatName = identifier;
            }
            
            const index = appData.user.activeChats.indexOf(chatName);
            if (index !== -1) {
                appData.user.activeChats.splice(index, 1);
                saveData();
                showContainer('chat-list');
                updateChatList();
                alert(`–í—ã –ø–æ–∫–∏–Ω—É–ª–∏ —á–∞—Ç "${chatName}"`);
            }
        }
        
        // –î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞
        function createChatDialog() {
            const type = confirm("–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç? (OK - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, –û—Ç–º–µ–Ω–∞ - –ø—É–±–ª–∏—á–Ω—ã–π)");
            const name = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞:");
            
            if (!name) return;
            
            if (type) {
                const code = generateChatCode();
                appData.privateChats[code] = {
                    name: name,
                    messages: [],
                    members: [appData.user.id]
                };
                appData.user.activeChats.push(name);
                alert(`–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç —Å–æ–∑–¥–∞–Ω!\n–ö–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞: ${code}\n–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –∫–æ–¥–æ–º —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.`);
            } else {
                if (!appData.chats[name]) {
                    appData.chats[name] = {
                        type: "public",
                        messages: [],
                        members: [appData.user.id]
                    };
                }
                appData.user.activeChats.push(name);
            }
            
            saveData();
            updateChatList();
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —á–∞—Ç–∞
        function generateChatCode() {
            return Math.random().toString(36).substring(2, 8);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileFields() {
            document.getElementById('first-name').value = appData.user.firstName;
            document.getElementById('last-name').value = appData.user.lastName;
            document.getElementById('username').value = appData.user.username;
            document.getElementById('birthday').value = appData.user.birthday || "–ì–ì–ì–ì-–ú–ú-–î–î";
            document.getElementById('bio').value = appData.user.bio;
            document.getElementById('user-id').value = appData.user.id;
            document.getElementById('user-avatar').textContent = appData.user.avatar;
        }
        
        // –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞
        function changeAvatar() {
            const avatars = ['üòÄ', 'üòé', 'ü§ñ', 'üëΩ', 'üê∂', 'üê±', 'ü¶ä', 'üêº', 'ü¶Ñ', 'üêô', 'üçï', 'üéÆ', 'üöÄ'];
            const newAvatar = avatars[Math.floor(Math.random() * avatars.length)];
            appData.user.avatar = newAvatar;
            document.getElementById('user-avatar').textContent = newAvatar;
            saveData();
        }
        
        // –°–º–µ–Ω–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞
        function changeUsername() {
            if (checkBlocked('username')) return;
            
            const newUsername = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —é–∑–µ—Ä–Ω–µ–π–º (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å @, —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã):", `@${appData.user.username}`);
            if (!newUsername) return;
            
            if (!newUsername.startsWith('@')) {
                alert("–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @");
                return;
            }
            
            const cleanUsername = newUsername.substring(1);
            if (!/^[a-zA-Z0-9]+$/.test(cleanUsername)) {
                alert("–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã");
                return;
            }
            
            if (appData.usernames.has(cleanUsername) && cleanUsername !== appData.user.username) {
                alert("–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç");
                return;
            }
            
            const now = new Date();
            const changesLast24h = appData.user.usernameChanges.filter(t => {
                const changeTime = new Date(t);
                return (now - changeTime) < 24 * 60 * 60 * 1000;
            });
            
            if (changesLast24h.length >= 10) {
                const blockUntil = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                appData.user.blockedUntil = blockUntil.toISOString();
                appData.user.bans = (appData.user.bans || 0) + 1;
                
                if (appData.user.bans >= 30) {
                    alert("–í—ã –±—ã–ª–∏ –∑–∞–±–∞–Ω–µ–Ω—ã –∑–∞ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π —é–∑–µ—Ä–Ω–µ–π–º–∞");
                    window.location.reload();
                    return;
                }
                
                alert("–í—ã —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç–µ —é–∑–µ—Ä–Ω–µ–π–º. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 24 —á–∞—Å–∞.");
                saveData();
                checkRestrictions();
                return;
            }
            
            appData.usernames.delete(appData.user.username);
            appData.user.username = cleanUsername;
            appData.usernames.add(cleanUsername);
            document.getElementById('username').value = cleanUsername;
            
            appData.user.usernameChanges.push(now.toISOString());
            saveData();
            alert("–Æ–∑–µ—Ä–Ω–µ–π–º —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω");
            checkRestrictions();
        }
        
        // –°–º–µ–Ω–∞ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è
        function changeBirthday() {
            if (checkBlocked('birthday')) return;
            
            const newBirthday = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è (–ì–ì–ì–ì-–ú–ú-–î–î):", appData.user.birthday || "2000-01-01");
            if (!newBirthday) return;
            
            if (!/^\d{4}-\d{2}-\d{2}$/.test(newBirthday)) {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ì–ì–ì–ì-–ú–ú-–î–î");
                return;
            }
            
            const now = new Date();
            const changesLast24h = appData.user.birthdayChanges.filter(t => {
                const changeTime = new Date(t);
                return (now - changeTime) < 24 * 60 * 60 * 1000;
            });
            
            if (changesLast24h.length >= 10) {
                const blockUntil = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                appData.user.birthdayBlockedUntil = blockUntil.toISOString();
                appData.user.bans = (appData.user.bans || 0) + 1;
                
                if (appData.user.bans >= 30) {
                    alert("–í—ã –±—ã–ª–∏ –∑–∞–±–∞–Ω–µ–Ω—ã –∑–∞ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è");
                    window.location.reload();
                    return;
                }
                
                alert("–í—ã —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 24 —á–∞—Å–∞.");
                saveData();
                checkRestrictions();
                return;
            }
            
            appData.user.birthday = newBirthday;
            document.getElementById('birthday').value = newBirthday;
            
            appData.user.birthdayChanges.push(now.toISOString());
            saveData();
            alert("–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∞");
            checkRestrictions();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        function checkBlocked(type) {
            const now = new Date();
            const blockField = type === 'username' ? 'blockedUntil' : 'birthdayBlockedUntil';
            
            if (appData.user[blockField]) {
                const blockTime = new Date(appData.user[blockField]);
                if (now < blockTime) {
                    const remaining = blockTime - now;
                    const hours = Math.floor(remaining / (60 * 60 * 1000));
                    const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000);
                    alert(`–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Å–º–µ–Ω–∏—Ç—å ${type === 'username' ? '—é–∑–µ—Ä–Ω–µ–π–º' : '–¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è'}. –û—Å—Ç–∞–ª–æ—Å—å: ${hours} —á. ${minutes} –º–∏–Ω.`);
                    return true;
                }
            }
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        function checkRestrictions() {
            const now = new Date();
            let status = "‚úÖ –í—ã —Å–≤–æ–±–æ–¥–Ω—ã –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π";
            
            if (appData.user.blockedUntil) {
                const blockTime = new Date(appData.user.blockedUntil);
                if (now < blockTime) {
                    const remaining = blockTime - now;
                    const hours = Math.floor(remaining / (60 * 60 * 1000));
                    const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000);
                    status = `‚õî –ò–∑–º–µ–Ω–µ–Ω–∏–µ —é–∑–µ—Ä–Ω–µ–π–º–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –û—Å—Ç–∞–ª–æ—Å—å: ${hours} —á. ${minutes} –º–∏–Ω.`;
                }
            }
            
            if (appData.user.birthdayBlockedUntil) {
                const blockTime = new Date(appData.user.birthdayBlockedUntil);
                if (now < blockTime) {
                    const remaining = blockTime - now;
                    const hours = Math.floor(remaining / (60 * 60 * 1000));
                    const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000);
                    if (status.includes("‚õî")) {
                        status += `\n‚õî –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –û—Å—Ç–∞–ª–æ—Å—å: ${hours} —á. ${minutes} –º–∏–Ω.`;
                    } else {
                        status = `‚õî –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –û—Å—Ç–∞–ª–æ—Å—å: ${hours} —á. ${minutes} –º–∏–Ω.`;
                    }
                }
            }
            
            document.getElementById('restriction-status').textContent = status;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        function saveProfile() {
            appData.user.firstName = document.getElementById('first-name').value;
            appData.user.lastName = document.getElementById('last-name').value;
            appData.user.bio = document.getElementById('bio').value;
            
            saveData();
            alert("–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã");
        }
    </script>
</body>
</html>
